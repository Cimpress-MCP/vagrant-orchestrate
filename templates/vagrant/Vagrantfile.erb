Vagrant.configure("2") do |config|
  <% if provisioners.include? "shell" -%>
  <% shell_paths.each do |path| -%>
  config.vm.provision "shell", path: "<%= path %>"
  <% end -%>
  <% end -%>
  <% if provisioners.include? "puppet" -%>
  config.vm.provision "puppet" do |puppet|
  end
  <% end -%>
  <% if communicator == "ssh" -%>
  config.ssh.username = "<%= ssh_username %>"
  <% if ssh_password -%>
  config.ssh.password = "<%= ssh_password %>"
  <% end -%>
  <% if !ssh_password -%>
  config.ssh.private_key_path = "<%= ssh_private_key_path %>"
  <% end -%>
  <% end -%>
  <% if communicator == "winrm" -%>
  config.vm.communicator = "<%= communicator %>"
  config.winrm.username = "<%= winrm_username %>"
  config.winrm.password = "<%= winrm_password %>"
  <% end -%>

  if File.exist?("Catfishfile.lock")
    instances = File.readlines("Catfishfile.lock").map(&:chomp)
    instances.each do |instance|
      config.vm.define "managed-#{instance}" do |box|
        box.vm.box = "tknerr/managed-server-dummy"
        box.vm.provider :managed do |managed, override|
          managed.server = instance
        end
      end
    end
  end
end
